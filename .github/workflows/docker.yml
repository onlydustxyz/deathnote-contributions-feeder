name: docker

on:
  push:
    branches:
      - 'main'
    tags:
      - 'v*'

jobs:
  docker-rest-api:
    uses: onlydustxyz/cicd/.github/workflows/docker-workflow.yml@main
    with:
      image_name: deathnote-contribution-feeder-rest-api
      image_tag: ${{ github.ref_name }}
      bin_name: deathnote_contributions_feeder
      dockerfile: diesel-rocket-rs
      datadog_label: '[{"source": "deathnote", "service": "deathnote-contribution-feeder-rest-api"}]'
    secrets: inherit

  docker-pr-uploader:
    uses: onlydustxyz/cicd/.github/workflows/docker-workflow.yml@main
    with:
      image_name: deathnote-contribution-feeder-contribution-uploader
      image_tag: ${{ github.ref_name }}
      bin_name: upload_contributions
      dockerfile: diesel-rs
      datadog_label: '[{"source": "deathnote", "service": "deathnote-contribution-feeder-contribution-uploader"}]'
    secrets: inherit

  docker-repo-indexer:
    uses: onlydustxyz/cicd/.github/workflows/docker-workflow.yml@main
    with:
      image_name: deathnote-contribution-feeder-project-indexer
      image_tag: ${{ github.ref_name }}
      bin_name: index_projects
      dockerfile: diesel-rs
      datadog_label: '[{"source": "deathnote", "service": "deathnote-contribution-feeder-project-indexer"}]'
    secrets: inherit
